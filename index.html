<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÅ Cadeau AI16Z - Ton Token Exclusif</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Password Protection Screen -->
    <div id="password-screen" class="screen active">
        <div class="container">
            <div class="card">
                <div class="header">
                    <div class="logo">
                        <img src="img/head.png" alt="AI16Z" class="header-image">
                    </div>
                    <h1>üéÅ Cadeau Sp√©cial AI16Z</h1>
                    <p>Entre le mot de passe pour acc√©der √† ton cadeau exclusif</p>
                </div>
                <div class="form-group">
                    <input type="password" id="password-input" placeholder="Mot de passe..." maxlength="50">
                    <button id="password-submit" onclick="checkPassword()">Acc√©der</button>
                </div>
                <div id="password-error" class="error hidden">Mot de passe incorrect. R√©essaie.</div>
            </div>
        </div>
    </div>

    <!-- Main Claim Screen -->
    <div id="claim-screen" class="screen">
        <div class="container">
            <div class="card">
                <div class="header">
                    <div class="logo">
                        <img src="img/head.png" alt="Kenny AI16Z" class="header-image">
                    </div>
                    <h1>üöÄ R√©cup√©rer tes Tokens AI16Z</h1>
                    <p id="welcome-message">F√©licitations ! Tu as un cadeau AI16Z exclusif qui t'attend.</p>
                </div>
                
                <!-- Wallet Connection -->
                <div id="wallet-section">
                    <button id="connect-wallet" class="wallet-btn" onclick="connectWallet()">
                        Connecter ton Wallet
                    </button>
                    <div id="wallet-info" class="wallet-info hidden">
                        <div class="wallet-address">
                            <span>Connect√© : </span>
                            <span id="wallet-address"></span>
                        </div>
                        <button id="disconnect-wallet" onclick="disconnectWallet()">D√©connecter</button>
                    </div>
                </div>

                <!-- Claim Button -->
                <div id="claim-section" class="hidden">
                    <div class="claim-info">
                        <div class="token-info">
                            <div class="token-details">
                                <h3>Tokens AI16Z</h3>
                                <p>Ton cadeau t'attend !</p>
                                
                                <button id="reveal-amount-btn" class="reveal-btn" onclick="revealAmount()">
                                    üéÅ Voir mon cadeau
                                </button>
                                
                                <div id="token-amount" class="token-amount hidden">
                                    <div class="token-label">Montant disponible</div>
                                    <div class="token-value">
                                        <span id="token-amount-value"></span>
                                        <span class="token-symbol">AI16Z</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="vault-info" class="vault-info hidden">
                            <div class="vault-address">
                                <strong>Adresse du Vault :</strong>
                                <span id="vault-address-display"></span>
                            </div>
                        </div>
                    </div>
                    <button id="claim-button" class="claim-btn" onclick="claimTokens()">
                        <span id="claim-text">üéÅ R√©cup√©rer mon Cadeau AI16Z</span>
                        <div id="claim-loader" class="loader hidden"></div>
                    </button>
                </div>

                <!-- Success/Error Messages -->
                <div id="success-message" class="success hidden">
                    <div class="success-banker">
                        <img src="img/banquier.png" alt="AI16Z Banker" class="banker-image">
                    </div>
                    <h3>üéâ Cadeau R√©cup√©r√© !</h3>
                    <p>Tes tokens AI16Z ont √©t√© transf√©r√©s avec succ√®s dans ton wallet.</p>
                    <div class="tx-link">
                        <a id="tx-link" href="#" target="_blank">Voir la Transaction</a>
                    </div>
                </div>

                <div id="error-message" class="error hidden">
                    <h3>‚ùå √âchec de la R√©cup√©ration</h3>
                    <p id="error-text">Quelque chose s'est mal pass√©. R√©essaie.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Already Claimed Screen -->
    <div id="claimed-screen" class="screen">
        <div class="container">
            <div class="card">
                <div class="header">
                    <h1>‚úÖ D√©j√† R√©cup√©r√©</h1>
                    <p>Ce cadeau a d√©j√† √©t√© r√©cup√©r√©. Merci !</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script>
        // Simple Base58 implementation for browser
        const BASE58_ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
        
        window.bs58 = {
            decode: function(str) {
                const bytes = [];
                for (let i = 0; i < str.length; i++) {
                    const char = str[i];
                    const charIndex = BASE58_ALPHABET.indexOf(char);
                    if (charIndex === -1) {
                        throw new Error(`Invalid character in base58: ${char}`);
                    }
                    
                    let carry = charIndex;
                    for (let j = 0; j < bytes.length; j++) {
                        carry += bytes[j] * 58;
                        bytes[j] = carry & 0xff;
                        carry >>= 8;
                    }
                    
                    while (carry) {
                        bytes.push(carry & 0xff);
                        carry >>= 8;
                    }
                }
                
                // Handle leading zeros
                for (let i = 0; i < str.length && str[i] === '1'; i++) {
                    bytes.push(0);
                }
                
                return new Uint8Array(bytes.reverse());
            }
        };
        
        console.log('‚úÖ Base58 decoder loaded');
    </script>
    <script>
        // Manual SPL Token implementation using only Solana Web3.js
        const TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA');
        const ASSOCIATED_TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL');
        
        // Create our own SPL Token functions
        window.splToken = {
            async getAssociatedTokenAddress(mint, owner, allowOwnerOffCurve = false) {
                const [address] = await solanaWeb3.PublicKey.findProgramAddress(
                    [
                        owner.toBuffer(),
                        TOKEN_PROGRAM_ID.toBuffer(),
                        mint.toBuffer(),
                    ],
                    ASSOCIATED_TOKEN_PROGRAM_ID
                );
                return address;
            },
            
            createTransferInstruction(source, destination, owner, amount, multiSigners = []) {
                const keys = [
                    { pubkey: source, isSigner: false, isWritable: true },
                    { pubkey: destination, isSigner: false, isWritable: true },
                    { pubkey: owner, isSigner: true, isWritable: false },
                ];
                
                // Add multisigners if any
                multiSigners.forEach((signer) => {
                    keys.push({ pubkey: signer.publicKey, isSigner: true, isWritable: false });
                });
                
                const data = new Uint8Array(9);
                data[0] = 3; // Transfer instruction
                
                // Convert amount to bytes (little endian)
                const amountBig = BigInt(amount);
                for (let i = 0; i < 8; i++) {
                    data[1 + i] = Number((amountBig >> BigInt(8 * i)) & BigInt(0xff));
                }
                
                return new solanaWeb3.TransactionInstruction({
                    keys,
                    programId: TOKEN_PROGRAM_ID,
                    data,
                });
            },
            
            createAssociatedTokenAccountInstruction(payer, associatedToken, owner, mint) {
                const keys = [
                    { pubkey: payer, isSigner: true, isWritable: true },
                    { pubkey: associatedToken, isSigner: false, isWritable: true },
                    { pubkey: owner, isSigner: false, isWritable: false },
                    { pubkey: mint, isSigner: false, isWritable: false },
                    { pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
                    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },
                    { pubkey: solanaWeb3.SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false },
                ];
                
                return new solanaWeb3.TransactionInstruction({
                    keys,
                    programId: ASSOCIATED_TOKEN_PROGRAM_ID,
                    data: new Uint8Array(0), // No data needed for ATA creation
                });
            }
        };
        
        console.log('‚úÖ Manual SPL Token implementation ready!');
    </script>
    <script src="vault.js"></script>
    <script src="script.js"></script>
</body>
</html> 